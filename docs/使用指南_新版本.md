# 🦴 交互式仿生骨支架生成器 - 使用指南

## ✨ 新版本特性

### 🎮 直接输入数值的交互方式
- ✅ **文本输入框**：直接输入精确数值，无需拖动滑块
- ✅ **实时参数验证**：自动限制在有效范围内
- ✅ **按Enter确认**：输入后按Enter键更新参数

### 🎨 增强的可视化效果

#### 1. 彩色3D Voronoi图（类似参考图1）
- ✅ **多彩多面体**：每个Voronoi单元使用不同颜色
- ✅ **清晰边界**：深色边缘线条
- ✅ **种子点标记**：黑色圆点标记每个单元中心
- ✅ **专业渲染**：高质量3D效果

#### 2. 仿真支架图（类似SEM扫描电镜）
- ✅ **灰度渲染**：模拟扫描电镜效果
- ✅ **光照模型**：根据面法向量计算光照
- ✅ **多视角展示**：4个不同角度（透视×2 + 侧视 + 俯视）
- ✅ **黑色背景**：专业SEM图像风格

## 🚀 快速开始

### 启动交互式界面

```bash
python 支持梯度的Voronoi支架生成器.py
# 输入: 1
```

## 🎮 交互界面使用

### 界面布局

```
┌─────────────────────┬─────────────────────┐
│  3D种子分布         │  彩色3D Voronoi     │
│  (梯度着色)         │  (多彩多面体)       │
│                     │                     │
│                     │                     │
└─────────────────────┴─────────────────────┘
┌──────┬──────┬──────┬─────────────────────┐
│密度  │孔隙  │梯度  │   统计信息          │
│分布  │分析  │曲线  │                     │
└──────┴──────┴──────┴─────────────────────┘

参数输入框（直接输入数值）:
┌────────────────────────────────────────┐
│ Cortical Density (seeds/mm³):  [25000]│
│ Transition Density (seeds/mm³):[12000]│
│ Trabecular Density (seeds/mm³):[6000] │
│ Target Porosity (%):           [68]   │
└────────────────────────────────────────┘

   [Generate Scaffold]  [Save STL]  [Save Visuals]
```

### 参数输入方法

#### 方法1: 直接修改数值
1. 点击输入框
2. 输入新数值（例如：`30000`）
3. 按 **Enter** 键确认
4. 点击 **"Generate Scaffold"** 按钮生成新支架

#### 方法2: 批量修改后生成
1. 逐个修改所有参数（按Enter确认每个）
2. 全部修改完成后
3. 点击 **"Generate Scaffold"** 一次性生成

### 参数范围

| 参数 | 范围 | 推荐值 | 说明 |
|------|------|--------|------|
| 皮质骨密度 | 5,000 - 40,000 | 25,000 | 外层致密区 |
| 过渡层密度 | 3,000 - 25,000 | 12,000 | 中间过渡区 |
| 松质骨密度 | 1,000 - 15,000 | 6,000 | 内层疏松区 |
| 目标孔隙率 | 40 - 85 | 68 | 整体孔隙率(%) |

### 按钮功能

#### 🟢 Generate Scaffold（生成支架）
- 根据当前输入框的数值生成新支架
- 自动更新所有6个可视化图表
- 计算孔隙大小和梯度特性

#### 🔵 Save STL（保存STL）
- 保存当前支架为3D打印用STL文件
- 同时保存JSON配置文件
- 文件名包含时间戳（避免覆盖）

#### 🟡 Save Visuals（保存可视化）
- 生成并保存3张高清图片：
  1. **彩色3D Voronoi图** - 多彩多面体展示
  2. **仿真支架图** - 4视角SEM风格图像
  3. **梯度分析图** - 完整的统计分析图

## 📸 输出文件示例

### 1. 彩色3D Voronoi图
```
colorful_voronoi_3d_20251026_143052.png
```
- 类似参考图1的多彩多面体
- 每个单元不同颜色
- 带黑色种子点标记
- 深色边界线条

### 2. 仿真支架图
```
realistic_scaffold_20251026_143052.png
```
- 类似参考图2的SEM风格
- 4个视角（2×2布局）
- 灰度渲染，黑色背景
- 带光照效果的立体感

### 3. 梯度分析图
```
gradient_analysis_20251026_143052.png
```
- 8个子图的完整分析
- 种子分布、孔隙统计
- 梯度曲线、层级信息

## 💡 使用技巧

### 快速调试参数

**例1: 测试高密度支架**
```
输入框设置:
  Cortical Density: 35000  ← 输入后按Enter
  Transition Density: 20000 ← 输入后按Enter
  Trabecular Density: 10000 ← 输入后按Enter
  Target Porosity: 55       ← 输入后按Enter

点击 "Generate Scaffold"
```

**例2: 测试高孔隙支架**
```
输入框设置:
  Cortical Density: 15000
  Transition Density: 8000
  Trabecular Density: 3000
  Target Porosity: 78

点击 "Generate Scaffold"
```

### 获得最佳可视化效果

1. **彩色Voronoi图**
   - 生成支架后，点击 "Save Visuals"
   - 会自动生成50个单元的彩色图
   - 颜色丰富，边界清晰

2. **仿真SEM图**
   - 同样点击 "Save Visuals"
   - 自动生成60个单元的4视角图
   - 灰度渲染，专业SEM效果

### 参数建议

#### 标准仿生骨（推荐）
```
Cortical: 25000
Transition: 12000
Trabecular: 6000
Porosity: 68%
```
- 孔隙梯度比: ~3.0
- 符合仿生学要求

#### 高强度支架
```
Cortical: 35000
Transition: 20000  
Trabecular: 10000
Porosity: 55%
```
- 适合承重应用
- 较低孔隙率

#### 高渗透性支架
```
Cortical: 15000
Transition: 8000
Trabecular: 3000
Porosity: 75%
```
- 适合营养物质扩散
- 较高孔隙率

## 🎨 可视化效果对比

### 彩色3D Voronoi图特点
- ✅ 30+ 种鲜艳颜色
- ✅ 每个多面体独立着色
- ✅ 黑色种子点（白色边缘）
- ✅ 深色边界线（2px）
- ✅ 透明度 90%
- ✅ 浅灰背景

### 仿真支架图特点
- ✅ 黑色背景（#1A1A1A）
- ✅ 灰度渲染（0.3-0.9强度）
- ✅ 基于法向量的光照
- ✅ 4个不同视角
- ✅ 白色坐标轴和文字
- ✅ 暗灰色网格线

## 📂 文件命名规则

所有文件保存在：
```
/Users/kiki/Desktop/bone scaffold/ Voronoi scaffold/
```

### 交互式界面保存的文件

#### STL文件
```
scaffold_20251026_143052.stl
config_20251026_143052.json
```

#### 可视化图片
```
colorful_voronoi_3d_20251026_143052.png
realistic_scaffold_20251026_143052.png
gradient_analysis_20251026_143052.png
```

时间戳格式: `YYYYMMDD_HHMMSS`

## ⚙️ 高级功能

### 编程接口使用

```python
from 支持梯度的Voronoi支架生成器 import InteractiveGradientScaffoldGenerator

# 创建生成器
gen = InteractiveGradientScaffoldGenerator(
    x_size=800e-6,
    y_size=800e-6,
    z_size=100e-6,
    target_porosity=0.68
)

# 方式1: 启动交互界面
gen.create_interactive_interface()

# 方式2: 编程方式生成
gen.surface_density = 25000
gen.middle_density = 12000
gen.core_density = 6000
gen.update_scaffold(None)

# 保存文件
gen.save_current_scaffold(None)
gen.save_visualizations(None)
```

### 单独生成可视化

```python
# 仅生成彩色Voronoi图
gen.generate_colorful_voronoi_3d('my_voronoi.png', max_cells=60)

# 仅生成仿真支架图
gen.generate_realistic_scaffold_image('my_scaffold.png')
```

## 🔧 故障排除

### Q: 输入数值后没反应？
**A**: 确保按了 **Enter** 键确认输入，然后点击 "Generate Scaffold"

### Q: 图片质量不够高？
**A**: 
- 直接使用 "Save Visuals" 按钮（自动300 DPI）
- 或修改代码中的 `dpi=300` 为 `dpi=600`

### Q: 颜色不够丰富？
**A**: 
- 增加 `max_cells` 参数（默认40-60）
- 颜色会自动循环使用30种颜色

### Q: SEM图太暗？
**A**: 
- 光照强度在代码中可调整（intensity公式）
- 当前范围: 0.3 - 0.9（可改为 0.5 - 1.0）

### Q: 生成速度慢？
**A**: 
- 减小支架尺寸
- 降低种子密度
- 减少显示的单元数量

## 📊 与参考图对比

### 你的参考图1（彩色Voronoi）
- ✅ 已实现：多彩多面体
- ✅ 已实现：清晰边界线
- ✅ 已实现：种子点标记
- ✅ 已实现：3D立体效果

### 你的参考图2（SEM支架）
- ✅ 已实现：灰度渲染
- ✅ 已实现：多孔结构
- ✅ 已实现：立体感
- ✅ 已实现：多视角展示

## 🎯 推荐工作流程

1. **启动界面**
   ```bash
   python 支持梯度的Voronoi支架生成器.py
   选择: 1
   ```

2. **调整参数**
   - 在输入框中修改数值
   - 按Enter确认每个参数

3. **生成预览**
   - 点击 "Generate Scaffold"
   - 查看6个实时图表

4. **满意后保存**
   - 点击 "Save Visuals" 保存图片
   - 点击 "Save STL" 保存3D模型

5. **继续优化**
   - 修改参数
   - 重复步骤3-4

## 📞 技术支持

- **代码位置**: `/Users/kiki/Desktop/bone scaffold/支持梯度的Voronoi支架生成器.py`
- **输出目录**: `/Users/kiki/Desktop/bone scaffold/ Voronoi scaffold/`
- **依赖包**: `numpy`, `scipy`, `matplotlib`, `numpy-stl`

---

**版本**: 2.0 (输入框交互 + 增强可视化)  
**更新日期**: 2025-10-26  
**作者**: Kiki
